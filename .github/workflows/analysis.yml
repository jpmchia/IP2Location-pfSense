name: code-analysis
on: [push, pull_request]

jobs:
    golangci:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
        - name: Run golangci-lint
          uses: golangci/golangci-lint-action@v3.7.0        
  
    golangci-matrix:
      name: staticheck
      strategy:
        fail-fast: false
        matrix:
          os: ["freebsd-latest", "ubuntu-latest", "macOS-latest", "windows-latest" ]
          go: ["1.20.x", "1.21.x"]
      runs-on: ${{ matrix.os }}
      steps:
        - name: Checkout
          uses: actions/checkout@v3
          with:
            fetch-depth: 1
        - name: Setup Go
          uses: actions/setup-go@v4
          with:
            go-version: '1.21'
            check-latest: true
            cache-dependency-path: backend/go.sum
            # cache-dependency-path: "**/*.sum"
          id: go
        - uses: WillAbides/setup-go-faster@v1.7.0
          with:
            go-version: ${{ matrix.go }}
        - run: "go test ./..."
        - run: "go vet ./..."
        - uses: dominikh/staticcheck-action@v1.3.0
          with:
            version: "2023.1.3"
            install-go: false
            cache-key: ${{ matrix.go }}